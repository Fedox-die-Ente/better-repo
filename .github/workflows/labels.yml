name: Setup Repository Labels

on:
  push:
    branches:
      - master
    paths-ignore:
      - '**'  

jobs:
  create-labels:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    env:
      LABELS_JSON: |
        [
          {"name": "üî¨ research", "color": "ededed", "description": "Research needed"},
          {"name": "‚öôÔ∏è ops", "color": "c2e0c6", "description": "Ops task"},
          {"name": "ü§ñ ci", "color": "bfdadc", "description": "Related to GitHub Actions / CI"},
          {"name": "üé¨ demo", "color": "bfdadc", "description": "Demo label"},
          {"name": "üêû bug", "color": "d73a4a", "description": "Bug report"},
          {"name": "‚ú® enhancement", "color": "a2eeef", "description": "Feature request / enhancement"},
          {"name": "üìö documentation", "color": "0075ca", "description": "Documentation update"},
          {"name": "‚ùì question", "color": "d876e3", "description": "User question or inquiry"},
          {"name": "üôã help wanted", "color": "008672", "description": "Needs help from contributors"},
          {"name": "üå± good first issue", "color": "7057ff", "description": "Good entry point for new contributors"},
          {"name": "üö´ wontfix", "color": "ffffff", "description": "Issue won't be fixed"},
          {"name": "üîÅ duplicate", "color": "cccccc", "description": "Duplicate issue"},
          {"name": "‚ùå invalid", "color": "e6e6e6", "description": "Invalid issue or PR"},
          {"name": "‚è≥ in progress", "color": "fbca04", "description": "Work in progress"},
          {"name": "‚úÖ ready for review", "color": "0e8a16", "description": "PR ready for review"},
          {"name": "‚õî blocked", "color": "5319e7", "description": "Work is blocked"},
          {"name": "üî• priority: high", "color": "b60205", "description": "High priority"},
          {"name": "‚ö° priority: medium", "color": "d93f0b", "description": "Medium priority"},
          {"name": "üçÉ priority: low", "color": "0e8a16", "description": "Low priority"}
        ]
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            if (context.repo.repo === 'better-repo') {
              console.log('Template repo detected. Skipping label creation.');
              return;
            }

            const labels = JSON.parse(process.env.LABELS_JSON);
            for (const label of labels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  description: label.description || '',
                  color: label.color
                });
              } catch (error) {
                if (error.status === 422) {
                  console.log(`Label '${label.name}' already exists. Skipping.`);
                } else {
                  console.error(`Error creating label '${label.name}': ${error}`);
                }
              }
            }

            const path = '.github/workflows/labels.yml';
            const shaRes = await github.rest.repos.getContent({
              owner: context.repo.owner,
              repo: context.repo.repo,
              path
            });
            const sha = shaRes.data.sha;
            await github.rest.repos.deleteFile({
              owner: context.repo.owner,
              repo: context.repo.repo,
              path,
              message: 'Remove setup labels workflow',
              sha
            });
