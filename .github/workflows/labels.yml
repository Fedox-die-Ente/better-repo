name: Update repository labels

on:
  push:
    branches:
      - master
    paths:
      - '.github/workflows/labels.yml'

jobs:
  create-labels:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    env:
      LABELS_JSON: |
        [
          {"name": "ğŸ”¬ research", "color": "ededed", "description": "Research needed"},
          {"name": "âš™ï¸ ops", "color": "c2e0c6", "description": "Ops task"},
          {"name": "ğŸ¤– ci", "color": "bfdadc", "description": "Related to GitHub Actions / CI"},
          {"name": "ğŸ¬ demo", "color": "bfdadc", "description": "Demo label"},
          {"name": "ğŸ bug", "color": "d73a4a", "description": "Bug report"},
          {"name": "âœ¨ enhancement", "color": "a2eeef", "description": "Feature request / enhancement"},
          {"name": "ğŸ“š documentation", "color": "0075ca", "description": "Documentation update"},
          {"name": "â“ question", "color": "d876e3", "description": "User question or inquiry"},
          {"name": "ğŸ™‹ help wanted", "color": "008672", "description": "Needs help from contributors"},
          {"name": "ğŸŒ± good first issue", "color": "7057ff", "description": "Good entry point for new contributors"},
          {"name": "ğŸš« wontfix", "color": "ffffff", "description": "Issue won't be fixed"},
          {"name": "ğŸ” duplicate", "color": "cccccc", "description": "Duplicate issue"},
          {"name": "âŒ invalid", "color": "e6e6e6", "description": "Invalid issue or PR"},
          {"name": "â³ in progress", "color": "fbca04", "description": "Work in progress"},
          {"name": "âœ… ready for review", "color": "0e8a16", "description": "PR ready for review"},
          {"name": "â›” blocked", "color": "5319e7", "description": "Work is blocked"},
          {"name": "ğŸ”¥ priority: high", "color": "b60205", "description": "High priority"},
          {"name": "âš¡ priority: medium", "color": "d93f0b", "description": "Medium priority"},
          {"name": "ğŸƒ priority: low", "color": "0e8a16", "description": "Low priority"}
        ]
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const labels = JSON.parse(process.env.LABELS_JSON);
            for (const label of labels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  description: label.description || '',
                  color: label.color
                });
              } catch (error) {
                if (error.status === 422) {
                  console.log(`Label '${label.name}' already exists. Skipping.`);
                } else {
                  console.error(`Error creating label '${label.name}': ${error}`);
                }
              }
            }
